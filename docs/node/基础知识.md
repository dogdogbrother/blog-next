---
title: node基础
tags: 后端 node
book: node
---

## 常用的内置模块

## **filename / **dirname

- `__filename` 表示当前正在执行的脚本文件的绝对路径。
- `__dirname` 表示当前执行脚本所在目录的绝对路径。

```js
console.log(__filename); // 输出文件的绝对路径 /Users/senlin/node.js
console.log(__dirname); // 输出目录的绝对路径 /Users/senlin
```

> 这 2 个变量，只在 CJS 模块下存在,ESM 下会报错,可以用如下方法处理下

```js
import { fileURLToPath } from "url";
import { dirname } from "path";
import { createRequire } from "module";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

console.log("__filename", __filename);
console.log("__dirname", __dirname);
```

## process

process 对象提供了与当前 Node.js 进程相关的信息和控制方法，下面是一些常用的 process 属性。

- `process.argv` 返回一个数组，包含启动 Node.js 进程时传递的命令行参数。第一个参数是 Node 在机器上的位置,第二个参数是执行文件的绝对路径，后续参数都为用户传递的自定义参数.

![node-process](/docImg/node-process.jpg)

- `process.cwd()` 获取当前工作目录的绝对路径.(也就是当前终端执行 node 命令的路径)
- `process.env` 获取当前执行环境的环境变量 (对象形式)。简单场景这个环境变量可以通过执行命令的时候直接设置.

![node-process-env](/docImg/node-process-env.jpg)

- `process.version` 获取当前 Node 版本。
- `process.stdout` 标准输出流，常用 `process.stdout.write` 进行数据写入。

```js
process.stdout.write("hello");
process.stdout.write(" ");
process.stdout.write("world");
process.stdout.write("\n");
```

通过它我们可以进行不换行的内容输出

![node-process-stdout-write](/docImg/node-process-stdout-write.jpg)

- `process.stdin` 用于从标准输入流 (stdin) 读取数据.

```js
// 监听用户输入数据
process.stdin.on("data", (data) => {
  console.log(`User input: ${data}`);
});
```

![node-process-stdin](/docImg/node-process-stdin.jpg)

## path

### path.join

将多个路径拼接成一个相对路径 (或绝对路径，取决于第一个路径是否为根路径)。

```js
import path from "path";

console.log(path.join("a", "b", "c")); // 输出 a/b/c
console.log(path.join(process.cwd(), "/hello", "world")); // 输出 /Users/senlin/hello/world
```

### path.resolve

将多个路径拼接成一个绝对路径，返回一个解析后的绝对路径。

即如果传入相对路径，会以当前工作目录为基准，计算出绝对路径，如果传入了绝对路径，则以传入的绝对路径为基准。

```js
import path from "path";

console.log(path.resolve("a", "b", "c")); // 输出 /Users/senlin/a/b/c
console.log(path.resolve("/hello", "world", "./a", "b")); // 输出 /hello/world/a/b
```

### path.dirname

返回路径中的目录名。

```js
console.log(path.dirname("/a/b/c")); // 因为c是文件 所以会输出 /a/b
```

### path.basename

返回路径中的文件名，并可选地去除给定的文件扩展名。

```js
console.log(path.basename("a/b/c.js")); // c.js
console.log(path.basename("a/b/c.js", ".js")); // c
console.log(path.basename("a/b/c.js", "js")); // c.
console.log(path.basename("a/b/c.js", "s")); // c.j
```

### path.extname

获取路径中的文件扩展名。

```js
console.log(path.extname("a/b/c.js")); // .js
console.log(path.extname("a/b/c")); // 空内容
console.log(path.extname("a/b/c.d.ts")); // .ts
console.log(path.extname("a/b/.npmrc")); // 空内容
```

### path.normalize

主要用于规范化路径，例如`//a/..//b`这种的混乱路径.

```js
path.normalize("a//b//c/d/e/.."); // a/b/c/d
```

### path.parse

用于解析文件路径，将其拆分为一个对象。

```js
path.parse("/home/user/file.txt");
/**
 * 输出内容:
 * {
 *  root: '/',
 *  dir: '/home/user',
 *  base: 'file.text',
 *  ext: '.txt',
 *  name: 'file'
 * }
 */
```

### path.sep

返回当前系统文件路径使用的分隔符。例如在 Windows 操作系统上，`path.sep` 的值为反斜杠 `\`，而在 Unix 操作系统上则为正斜杠 `/`。

## fs 文件系统模块

`fs` 的调用支持同步`sync`,异步`async`和`callback`回调三种方式.

```js
import fs from "fs";

// 同步读取
const syncData = fs.readFileSync("./test.txt", "utf-8");
console.log(syncData);

// 回调形式
fs.readFile("./test.txt", "utf-8", (err, callbackData) => {
  if (!err) {
    console.log(callbackData);
  }
});

// promise形式 异步读取
fs.promises.readFile("./test.txt", "utf-8").then((promiseData) => {
  console.log(promiseData);
});

// promise 形式还可以是如下写法
// import fs from 'fs/promises'
// fs.readFile('./test.txt', 'utf-8').then((promiseData) => {
//   console.log(promiseData)
// })
```

### 读取文件

`fs.readFileSync`

- 参数 1：设置要读取的文件路径 (相对或者绝对)；
- 参数 2 (可选)：设置读取的编码格式,默认为二进制形式读取。

### 读取文件

`fs.writeFileSync`

- 参数 1：输出文件路径；
- 参数 2：输出内容。
- 参数 3 (可选)：编码格式。

写入二进制文件 (读取一个图片，然后输出到一个新的位置)。

```js
// 读取一个图片
const imgBuf = fs.readFileSync("./logo.png");

// 写入到新文件
fs.writeFileSync("newLogo.png", imgBuf, "binary");
```

### 获取文件信息

通过 `fs.statSync` 获取文件或者目录的基本信息。

```js
import fs from "fs";

console.log(fs.statSync("./test.txt"));
console.log(fs.statSync("./test-dir"));
```

![node-fs-statSync](/docImg/node-fs-statSync.jpg)

| 属性名      | 描述                                                                        |
| ----------- | --------------------------------------------------------------------------- |
| size        | 该文件的大小，以字节为单位。                                                |
| atimeMs     | 最后访问时间，以毫秒为单位。                                                |
| mtimeMs     | 最后修改时间，以毫秒为单位。                                                |
| ctimeMs     | 最后状态改变时间，以毫秒为单位。                                            |
| birthtimeMs | 创建时间，以毫秒为单位。                                                    |
| atime       | 最后访问时间的格式化字符串，通常为 “YYYY-MM-DDTHH:MM:SS.mmmzz” 的形式。     |
| mtime       | 最后修改时间的格式化字符串，通常为 “YYYY-MM-DDTHH:MM:SS.mmmzz” 的形式。     |
| ctime       | 最后状态改变时间的格式化字符串，通常为 “YYYY-MM-DDTHH:MM:SS.mmmzz” 的形式。 |
| birthtime   | 创建时间的格式化字符串，通常为 “YYYY-MM-DDTHH:MM:SS.mmmzz” 的形式。         |

返回的对象上还包含可直接调用的方法，用于判断文件类型.

```js
const fileInfo = fs.statSync("./test.txt");
// 判断是文件还是目录
console.log(fileInfo.isFile(), fileInfo.isDirectory());

try {
  // 查询一个不存在的文件/目录信息（会抛出异常，需要自行捕获）
  fs.statSync("not_exist.txt");
} catch (e) {
  console.log("文件不存在");
}
```

### 追加输出

使用 `fs.appendFileSync` 向文件末尾追加写入内容。

```js
// 参数1：指定文件路径
// 参数2：要追加的内容
fs.appendFileSync("test.txt", "Hello World2!");
```

### 移动/重命名文件

`fs.renameSync` 方法用于文件移动，当然也可以是重命名文件。

```js
// 重命名
fs.renameSync("test.txt", "test2.txt");
// 移动文件
fs.renameSync("test2.txt", "test-dir/test2.txt");
```
